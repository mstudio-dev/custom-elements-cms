{# Template für Form-Widget als Element-Type #}
{% if data.form_id %}
    {% set form = repository('Form').find(data.form_id) %}
    
    {% if form %}
        <div class="form-widget my-4">
            {% if data.headline %}
                <h2>{{ data.headline }}</h2>
            {% endif %}
            
            {# Erfolgsmeldung #}
            {% for message in app.flashes('form_success') %}
                <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
            
            {# Fehlermeldungen #}
            {% for message in app.flashes('form_error') %}
                <div class="alert alert-danger">{{ message | raw }}</div>
            {% endfor %}
            
            <form method="post" action="{{ path('form_submit', {id: form.id}) }}" class="needs-validation" novalidate>
                {# Honeypot-Spam-Schutz (verstecktes Feld) #}
                <input type="text" name="_hp" style="position:absolute;left:-9999px" tabindex="-1" autocomplete="off">
                
                {% for field in form.fields %}
                    <div class="mb-3">
                        <label for="field_{{ field.id }}" class="form-label">
                            {{ field.label }}
                            {% if field.required %}
                                <span class="text-danger">*</span>
                            {% endif %}
                        </label>
                        
                        {% if field.type == 'textarea' %}
                            <textarea 
                                id="field_{{ field.id }}"
                                name="{{ field.name }}" 
                                class="form-control"
                                rows="5"
                                {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
                                {% if field.required %}required{% endif %}
                            ></textarea>
                        
                        {% elseif field.type == 'select' %}
                            <select 
                                id="field_{{ field.id }}"
                                name="{{ field.name }}" 
                                class="form-select"
                                {% if field.required %}required{% endif %}
                            >
                                <option value="">- Bitte wählen -</option>
                                {% if field.options %}
                                    {% for option in field.options %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        
                        {% elseif field.type == 'checkbox' %}
                            <div class="form-check">
                                <input 
                                    type="checkbox" 
                                    id="field_{{ field.id }}"
                                    name="{{ field.name }}" 
                                    class="form-check-input"
                                    value="1"
                                    {% if field.required %}required{% endif %}
                                >
                                <label class="form-check-label" for="field_{{ field.id }}">
                                    {{ field.helpText }}
                                </label>
                            </div>
                        
                        {% else %}
                            <input 
                                type="{{ field.type }}" 
                                id="field_{{ field.id }}"
                                name="{{ field.name }}" 
                                class="form-control"
                                {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}
                                {% if field.required %}required{% endif %}
                            >
                        {% endif %}
                        
                        {% if field.helpText and field.type != 'checkbox' %}
                            <div class="form-text">{{ field.helpText }}</div>
                        {% endif %}
                    </div>
                {% endfor %}
                
                <button type="submit" class="btn btn-primary">Absenden</button>
            </form>
        </div>
    {% else %}
        <div class="alert alert-warning">Formular nicht gefunden.</div>
    {% endif %}
{% endif %}
